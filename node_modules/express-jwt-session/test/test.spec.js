/**
 * Created by lixiong on 16/3/31.
 */
var app = require("./app.js");
var request = require("supertest");
var chai = require("chai");

global.expect = chai.expect;

describe('Test express-jwt-session:', function() {
    var token,
        expressServerApp = request(app);

    describe('GET /getWithAuth  with 401 code', function() {
        beforeEach(function(done) {
            expressServerApp
                .get('/getWithAuth')
                .expect(401)
                .end(function(err, res){
                    if (err) {
                        return done(err);
                    }
                    done();
                });;
        });
        it('should respond with 401 code', function() {
            console.log('Can not get success with no token auth');
        });
    });

    describe('GET Token /setAuth', function() {
        var user;
        beforeEach(function(done) {
            expressServerApp
                .get('/setAuth')
                .expect(200)
                .expect('Content-Type', /json/)
                .end(function(err, res){
                    if (err) {
                        return done(err);
                    }
                    token = res.body;
                    done();
                });
        });
        it('should respond with token', function() {
            expect(token).to.be.exist;
            console.log(token);
        });
    });

    describe('GET success /getWithAuth', function() {
        var user;
        beforeEach(function(done) {
            expressServerApp
                .get('/getWithAuth')
                .set('Authorization','Bearer ' + token.token)
                .expect(200)
                .expect('Content-Type', /json/)
                .end(function(err, res){
                    if (err) {
                        return done(err);
                    }
                    user = res.body;
                    done();
                });
        });
        it('should respond with auth success', function() {
            expect(user).to.be.exist;
            console.log(user);
        });
    });


});
